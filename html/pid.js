'use strict';var riot=require('riot');require('./slider.tag'),window.addEventListener('load',function(){'use strict';function a(s,t){riot.mount('#pslider',{boundMin:s.pMin,boundMax:s.pMax,myValue:t.pValue}),riot.mount('#islider',{boundMin:s.iMin,boundMax:s.iMax,myValue:t.iValue}),riot.mount('#dslider',{boundMin:s.dMin,boundMax:s.dMax,myValue:t.dValue})}function b(){var s=k[q.value],t=new ArrayBuffer(14),u=new DataView(t);u.setUint8(0,5),u.setUint8(1,s);var v=o('pslider').getAttribute('my-value'),w=o('islider').getAttribute('my-value'),x=o('dslider').getAttribute('my-value');u.setInt32(2,v*l,!0),u.setInt32(6,w*l,!0),u.setInt32(10,x*l,!0),n.send(t)}function c(s){var t=q.value,u=s.getUint8(1);if(u===k[t]){var v=s.getInt32(2,!0),w=s.getInt32(6,!0),x=s.getInt32(10,!0);a(j[t],{pValue:v*m,iValue:w*m,dValue:x*m})}}function f(){var s=k[q.value],t=new ArrayBuffer(2),u=new DataView(t);u.setUint8(0,7),u.setUint8(1,s),n.send(t)}var h=200,j={angle:{pMin:-3,pMax:2,iMin:-3,iMax:2,dMin:-3,dMax:2},angle_high:{pMin:-3,pMax:2,iMin:-3,iMax:2,dMin:-3,dMax:2},vel:{pMin:-3,pMax:2,iMin:-3,iMax:2,dMin:-4,dMax:1}},k={angle:0,angle_high:1,vel:2},l=65536,m=1/l,n=new WebSocket('ws://192.168.4.1/ws');n.binaryType='arraybuffer';var o=function byId(s){return document.getElementById(s)},q=o('pidSelect'),r=0;q.addEventListener('change',f),n.addEventListener('open',function(){f(),r=setInterval(b,h)}),n.addEventListener('message',function(s){var t=s.data,u=new DataView(t),v=u.getUint8(0);switch(v){case 8:if(14!=t.byteLength)break;c(u);break;case 13:if(1!=t.byteLength)break;window.alert('Saving settings failed');break;case 14:if(1!=t.byteLength)break;window.alert('Settings saved to flash');break;case 16:if(1!=t.byteLength)break;window.alert('Clearing parameters failed'),fetchValuesAndStartSending();break;case 19:if(14!=t.byteLength)break;c(u),r=setInterval(b,h);}}),o('btnSaveConfig').addEventListener('click',function(){var s=new ArrayBuffer(1),t=new DataView(s);t.setUint8(0,12),n.send(s)}),o('btnLoadDefaults').addEventListener('click',function(){var s=new ArrayBuffer(2),t=new DataView(s),u=k[q.value];0!==r&&(clearInterval(r),r=0),t.setUint8(0,18),t.setUint8(1,u),n.send(s)})});