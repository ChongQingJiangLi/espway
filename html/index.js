'use strict';window.addEventListener('load',function(){'use strict';function a(){h.innerText=A?'\u2611 Tilt control':'\u2610 Tilt control',h.style.backgroundColor=A?'#0bf':'#ddd'}function b(){A?(t=w/20,u=-v/20):p||o?(t=r-j.offsetLeft-l/2,u=m/2-(s-j.offsetTop),t/=l/2,u/=m/2):(t=0,u=0),t=Math.min(Math.max(t,-1),1),u=Math.min(Math.max(u,-1),1)}function c(B,C){if(1===g.readyState){var D=new DataView(new ArrayBuffer(3));D.setUint8(0),D.setInt8(1,127*B),D.setInt8(2,127*C),g.send(D.buffer)}}function d(){b();var B=(t+1)/2*l,C=(-u+1)/2*m;n.lineWidth=10,n.clearRect(0,0,l,m),n.beginPath(),n.moveTo(l/2,m/2),n.lineTo(B,C),n.stroke(),n.lineWidth=2,n.beginPath(),n.arc(B,C,15,0,2*Math.PI),n.fill(),n.stroke(),window.requestAnimationFrame(d)}var f=function byId(B){return document.getElementById(B)},g=new WebSocket('ws://192.168.4.1/ws');g.binaryType='arraybuffer';var h=f('tiltBtn'),i=f('battery'),j=f('joystick'),k=window.devicePixelRatio,l=j.clientWidth,m=j.clientHeight;j.width=l*k,j.height=m*k;var n=j.getContext('2d');n.lineWidth=10,n.strokeStyle='black',n.fillStyle='red',n.scale(k,k);var o=!1,p=!1,q=null,r=0,s=0,t=0,u=0,v=0,w=0,z=!1,A=!1;g.addEventListener('message',function(B){var C=new DataView(B.data),D=C.getUint8(0);if(3===D&&3===B.data.byteLength){var E=C.getInt16(1,!0)/100;i.innerText=E.toFixed(2)}}),window.addEventListener('mousemove',function(B){o&&(r=B.pageX,s=B.pageY)}),j.addEventListener('mousedown',function(B){o=!0,r=B.pageX,s=B.pageY}),window.addEventListener('mouseup',function(){o=!1}),j.addEventListener('touchstart',function(B){q=B.changedTouches[0].identifier,r=B.changedTouches[0].pageX,s=B.changedTouches[0].pageY,p=!0}),window.addEventListener('touchend',function(B){p&&null!==B.changedTouches.item(q)&&(p=!1)}),window.addEventListener('touchmove',function(B){var C=B.changedTouches.item(q);p&&null!==C&&(r=C.pageX,s=C.pageY),B.preventDefault()}),window.addEventListener('deviceorientation',function(B){null!==B.beta&&null!==B.gamma&&(!z&&(z=!0,h.style.display='inline',a()),v=B.beta,w=B.gamma)}),h.addEventListener('click',function(){A=!A,a()}),window.setInterval(function(){c(t,u)},100),window.requestAnimationFrame(d)});